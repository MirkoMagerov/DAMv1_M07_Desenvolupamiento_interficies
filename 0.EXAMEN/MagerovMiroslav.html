<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAWe1M06UF2 - Ex03</title>
    <style>
        * {
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-size: 10px;
        }

        h1 {
            font-size: 2.5rem;
        }

        h2 {
            font-size: 2rem;
        }

        .code,
        .result {
            font-family: 'Courier New', Courier, monospace;
            color: grey;
        }

        .result {
            color: blue;
        }

        article {
            border: 1px solid grey;
            margin: 5px;
            padding: 2px;
        }

        .importante {
            color: red;
        }

        .puntuacion {
            font-style: italic;

        }

        .codigo {
            font-family: 'Courier New', Courier, monospace;
            color: white;
            background-color: black;
        }

        .usuario {
            font-family: 'Courier New', Courier, monospace;
            color:black;
            background-color:  rgba(128, 128, 128, 0.411);
        }
    </style>
</head>

<body onload="init()">
    <h1>DAMv Examen de JavaScript</h1>
    <h2>DAMv1M07-UF1 2023-24</h2>
    <article>
        <h2> Entrega</h2>
        <p>Cambia el nombre de este fichero a <span class="importante">ApellidoNombre.html</span> y será el fichero
            inicial de entrada a tu programa</p>
    </article>
    <article>
        <h2> ITB Red Social</h2>
        <p>En el ITB se quiere crear una pequeña red social para que toda la comunidad pueda hacer publicaciones y
            añadir comentarios. Crea una estructura básica que implemente dichas necesidades, podrás personalizar las
            clases y añadir más funcionalidades según lo veas necesario.</p>

        <h4>Clase Usuario</h4>
        <p>
            Contiene los datos esenciales de un usuario, tiene: nombre, apellido, edad (privada) y nick
        </p>
        <h4>Clase Publicacion</h4>
        <p>
            Clase que representa una publicación de la red social, tiene: Contenido, fecha de publicación, número de
            likes (podrán añadirse o quitarse).
        </p>
        <h4>Clase Comentario</h4>
        <p>
            Texto del comentario, fecha de publicación y el usuario que ha realizado el comentario.
        </p>
        <h4>Clase UsuarioRedSocial</h4>
        <p>
            Hereda de la clase Usuario, Esta clase debe almacenar todas las publicaciones por un lado y los todos
            comentarios por otro, todos hechos por el usuario.
        </p>
        <h4>Clase Lista Usuarios </h4>
        <p>
            Contiene todas las instancias de UsuarioRedSocial. Dispone de métodos para insertar nuevos usuarios, obtener
            las información de un usuario concreto, mostrar la información de todos los usuarios.
        </p>
        <h4>JSON</h4>
        <p class="codigo">
            {<br>
            "usuarios": [<br>
            { "nombre": "Juan", "apellido": "González", "nick": "juang", "edad": 30 },<br>
            { "nombre": "María", "apellido": "López", "nick": "marial", "edad": 25 },<br>
            { "nombre": "Pedro", "apellido": "Martínez", "nick": "pedrom", "edad": 35 },<br>
            { "nombre": "Ana", "apellido": "Sánchez", "nick": "anas", "edad": 28 }<br>
            ],<br>
            "publicaciones": [<br>
            { "contenido": "¡Hola a todos!", "fecha": "2024-02-15", "likes": 10, "autor": "juang" },<br>
            { "contenido": "Hoy es un gran día", "fecha": "2024-02-14", "likes": 15, "autor": "marial" },<br>
            { "contenido": "Me encanta programar", "fecha": "2024-02-13", "likes": 20, "autor": "pedrom" }<br>
            ],<br>
            "comentarios": [<br>
            { "contenido": "Genial!", "fecha": "2024-02-15", "autor": "marial"},<br>
            { "contenido": "Estoy de acuerdo", "fecha": "2024-02-15", "autor": "anas"},<br>
            { "contenido": "Muy buena publicación", "fecha": "2024-02-14", "autor": "juang"},<br>
            { "contenido": "Sí, es fantástico", "fecha": "2024-02-13", "autor": "pedrom"},<br>
            { "contenido": "Totalmente", "fecha": "2024-02-13", "autor": "anas"},<br>
            { "contenido": "Me gusta mucho", "fecha": "2024-02-13", "autor": "marial"},<br>
            { "contenido": "Eso es genial", "fecha": "2024-02-14", "autor": "pedrom"},<br>
            { "contenido": "Buen trabajo!", "fecha": "2024-02-14", "autor": "juang"}<br>
            ]<br>
            }<br>
        </p>

        <h4>Implementación<span class="puntuacion"> 10 puntos (5,1,1,2,1) </span></h4>
        <ol>
            <li>Partiendo de un Json inicial, crea los objetos necesarios para almacenar toda esta información.</li>
            <li>Añade un nuevo usuario <i>TU</i></li>
            <li>Añade una nueva publicación a <i>marial</i> y otra a ti</li>
            <li>Crea un método o función que muestro los datos, publicaciones y comentarios de un usuario concreto
                (podeis hacerlo directamente con texto HTML). <i>marial</i></li>
            <li>Crea un método o función que muestre toda la información de los usuarios de la red social mostrando sus
                datos, sus publicaciones y sus comentarios (podeis hacerlo directamente con texto HTML).</li>
        </ol>

        <h5>Nota: Implementa todo en este fichero.</h5>

        <p></p>
        <h4>Resultado</h4>
    </article>

    <script>
    const datosRedSocialJson = `{
    "usuarios": [
    { "nombre": "Juan", "apellido": "González", "nick": "juang", "edad": 30 },
    { "nombre": "María", "apellido": "López", "nick": "marial", "edad": 25 },
    { "nombre": "Pedro", "apellido": "Martínez", "nick": "pedrom", "edad": 35 },
    { "nombre": "Ana", "apellido": "Sánchez", "nick": "anas", "edad": 28 }
    ],
    "publicaciones": [
    { "contenido": "¡Hola a todos!", "fecha": "2024-02-15", "likes": 10, "autor": "juang" },
    { "contenido": "Hoy es un gran día", "fecha": "2024-02-14", "likes": 15, "autor": "marial" },
    { "contenido": "Me encanta programar", "fecha": "2024-02-13", "likes": 20, "autor": "pedrom" }
    ],
    "comentarios": [
    { "contenido": "Genial!", "fecha": "2024-02-15", "autor": "marial"},
    { "contenido": "Estoy de acuerdo", "fecha": "2024-02-15", "autor": "anas"},
    { "contenido": "Muy buena publicación", "fecha": "2024-02-14", "autor": "juang"},
    { "contenido": "Sí, es fantástico", "fecha": "2024-02-13", "autor": "pedrom"},
    { "contenido": "Totalmente", "fecha": "2024-02-13", "autor": "anas"},
    { "contenido": "Me gusta mucho", "fecha": "2024-02-13", "autor": "marial"},
    { "contenido": "Eso es genial", "fecha": "2024-02-14", "autor": "pedrom"},
    { "contenido": "Buen trabajo!", "fecha": "2024-02-14", "autor": "juang"}]
    }`;

    /***************************************************************************/
    /**********************             CLASES              ********************/
    /***************************************************************************/
    class Usuario {
        #edad;

        constructor(nombre, apellido, nick, edad) {
            this.nombre = nombre;
            this.apellido = apellido;
            this.nick = nick;
            this.edad = edad;
        }

        get nombre() { return this._nombre; }
        set nombre(nombre) { this._nombre = nombre; }

        get apellido() { return this._apellido; }
        set apellido(apellido) { this._apellido = apellido; }

        get nick() { return this._nick; }
        set nick(nick) { this._nick = nick; }

        get edad() { return this.#edad; }
        set edad(edad) { this.#edad = edad; }
    }

    class Publicacion {
        constructor(contenido, fecha, likes, autor) {
            this.contenido = contenido;
            this.fecha = fecha;
            this.likes = likes;
            this.autor = autor;
        }

        get contenido() { return this._contenido; }
        set contenido(contenido) { this._contenido = contenido; }

        get fecha() { return this._fecha; }
        set fecha(fecha) { this._fecha = fecha; }

        get likes() { return this._likes; }
        set likes(likes) { this._likes = likes; }

        get autor() { return this._autor; }
        set autor(autor) { this._autor = autor; }
    }

    class Comentario {
        constructor(contenido, fecha, autor) {
            this.contenido = contenido;
            this.fecha = fecha;
            this.autor = autor;
        }

        get contenido() { return this._contenido; }
        set contenido(contenido) { this._contenido = contenido; }

        get fecha() { return this._fecha; }
        set fecha(fecha) { this._fecha = fecha; }

        get autor() { return this._autor; }
        set autor(autor) { this._autor = autor; }
    }

    class UsuarioRedSocial extends Usuario {
        constructor(nombre, apellido, nick, edad, publicaciones = [], comentarios = []) {
            super(nombre, apellido, nick, edad);
            this.publicaciones = publicaciones;
            this.comentarios = comentarios;
        }

        get publicaciones() { return this._publicaciones; }
        set publicaciones(publicaciones) { this._publicaciones = publicaciones; }

        get comentarios() { return this._comentarios; }
        set comentarios(comentarios) { this._comentarios = comentarios; }
        
        insertarPublicacion(publicacion) {
            this.publicaciones.push(publicacion);
        }

        insertarComentario(comentario) {
            this.comentarios.push(comentario);
        }
    }

    class ListaUsuarios {
        constructor() {
            this.usuarios = [];
        }

        get usuarios() { return this._usuarios; }
        set usuarios(usuarios) { this._usuarios = usuarios; }

        insertarUsuario(usuario) {
            this.usuarios.push(usuario);
        }

        mostrarUsuario(nick) {
            let usuario = this.usuarios.find(usuario => usuario.nick == nick);
            let texto = `<div class="usuario">`;
            texto += `<h3>${usuario.nombre} ${usuario.apellido} (${usuario.nick})</h3>`;
            texto += `<p>Edad: ${usuario.edad}</p>`;
            texto += "<h4>Publicaciones</h4>";
            usuario.publicaciones.forEach(publicacion => {
                texto += `<p>${publicacion.contenido} (${publicacion.fecha})</p>`;
            });
            texto += "<h4>Comentarios</h4>";
            usuario.comentarios.forEach(comentario => {
                texto += `<p>${comentario.contenido} (${comentario.fecha})</p>`;
            });
            texto += "</div>";
            return texto;
        }

        mostrarUsuarios() {
            let texto = '';
            this.usuarios.forEach(usuario => {
                texto += `<div class="usuario">`;
                texto += `<h3>${usuario.nombre} ${usuario.apellido} (${usuario.nick})</h3>`;
                texto += `<p>Edad: ${usuario.edad}</p>`;
                texto += "<h4>Publicaciones</h4>";
                usuario.publicaciones.forEach(publicacion => {
                    texto += `<p>${publicacion.contenido} (${publicacion.fecha})</p>`;
                });
                texto += "<h4>Comentarios</h4>";
                usuario.comentarios.forEach(comentario => {
                    texto += `<p>${comentario.contenido} (${comentario.fecha})</p>`;
                });
                texto += "</div>";
            });
            return texto;
        }
    }

    /***************************************************************************/
    /**********************         METODOS/FUNCIONES       ********************/
    /***************************************************************************/
    function init() {
        const ARTICULOS = document.querySelectorAll('article');
        const SEGUNDO_ARTICULO = ARTICULOS[1];

        // Parseamos la info de los json y la guardamos en constantes que luego usaremos
        const INFO = JSON.parse(datosRedSocialJson);

        const USUARIOS = getUsersFromArray(INFO);
        const PUBLICACIONES = getPublicationsFromArray(INFO);
        const COMENTARIOS = getCommentsFromArray(INFO);

        // EJERCICIO 2
        const MI_USUARIO = new Usuario('Miroslav', 'Magerov', 'MirkoMS', 18);
        USUARIOS.push(MI_USUARIO);

        // EJERCICIO 3
        const NUEVA_PUBLICACION_MARIAL = new Publicacion('Hoy es dia de examen', '2020-02-14', 15, 'marial');
        PUBLICACIONES.push(NUEVA_PUBLICACION_MARIAL);

        const NUEVA_PUBLICACION_YO = new Publicacion('Hola me llamo Mirko', '2022-02-15', 100, 'MirkoMS');
        PUBLICACIONES.push(NUEVA_PUBLICACION_YO);

        // Guardar los usuarios en una instancia de la clase ListaUsuarios que permite mostar todos los datos de todos los usuarios
        const LISTA_USUARIOS = new ListaUsuarios();
        USUARIOS.forEach(usuario =>  {
            const USUARIO_RED_SOCIAL = new UsuarioRedSocial(usuario.nombre, usuario.apellido, usuario.nick, usuario.edad);

            const PUBLICACIONES_USUARIO = PUBLICACIONES.filter(publicacion => publicacion.autor == usuario.nick);
            PUBLICACIONES_USUARIO.forEach(publicacion => USUARIO_RED_SOCIAL.insertarPublicacion(publicacion));

            const COMENTARIOS_USUARIO = COMENTARIOS.filter(comentario => comentario.autor == usuario.nick);
            COMENTARIOS_USUARIO.forEach(comentario => USUARIO_RED_SOCIAL.insertarComentario(comentario));

            LISTA_USUARIOS.insertarUsuario(USUARIO_RED_SOCIAL);
        });
        
        // Agregamos un div y insertamos toda la informacion del ejercicio dentro
        let resultadoDiv = document.createElement('div');
        resultadoDiv.id = 'resultado';
        SEGUNDO_ARTICULO.appendChild(resultadoDiv);

        // Mostrar los datos de un solo usuario
        let textoUsuarioUnico = `<p>-------- Solo usuario marial --------</p>`;
        textoUsuarioUnico += LISTA_USUARIOS.mostrarUsuario('marial');
        textoUsuarioUnico += `<p>---------------------------------------</p>`;
        resultadoDiv.innerHTML += textoUsuarioUnico;

        // Mostrar los datos de todos los usuarios
        let texto = LISTA_USUARIOS.mostrarUsuarios();
        resultadoDiv.innerHTML += texto;
    }

    function getUsersFromArray(INFO) {
        let result = [];
        for (let usuario of INFO.usuarios) {
            new Usuario(usuario.nombre, usuario.apellido, usuario.nick, usuario.edad);
            result.push(usuario);
        }
        return result;
    }

    function getPublicationsFromArray(INFO) {
        let result = [];
        for (let publicacion of INFO.publicaciones) {
            new Publicacion(publicacion.contenido, publicacion.fecha, publicacion.likes, publicacion.autor);
            result.push(publicacion);
        }
        return result;
    }

    function getCommentsFromArray(INFO) {
        let result = [];
        for (let comentario of INFO.comentarios) {
            new Comentario(comentario.contenido, comentario.fecha, comentario.autor);
            result.push(comentario);
        }
        return result;
    }

    </script>
</body>

</html>